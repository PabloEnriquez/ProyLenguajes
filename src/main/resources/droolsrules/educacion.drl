//created on: Apr 16, 2017
package com.trucutru
 import java.util.ArrayList;  
 import java.util.List;
import com.trucutru.model.*;

rule "Insertar datos"
	when
	then
		//---
		List<String> recoms = new ArrayList<String>();
		Estudiante e1 = new Estudiante("Pedro Paramo", 0.0, recoms);
		insert(e1);
		
		Materia m1 = new Materia("Fisica", "Rafael Lozano", 7);
		Materia m2 = new Materia("Matematicas", "Jose Castro", 8);
		insert(m1);
		insert(m2);
		
		Estudiante_materia estud_mat1 = new Estudiante_materia(m1.getId(), e1.getId(), 0.0, 0.0);
		Estudiante_materia estud_mat2 = new Estudiante_materia(m2.getId(), e1.getId(), 0.0, 0.0);
		insert(estud_mat1);
		insert(estud_mat2);
		//---
		Tema t1 = new Tema(m1.getId(), "MRUA", 7);
		Tema t2 = new Tema(m1.getId(), "CaidaLibre", 7);
		Tema t3 = new Tema(m2.getId(), "Limites", 7);
		Tema t4 = new Tema(m2.getId(), "Divisiones", 7);
		insert(t1);
		insert(t2);
		insert(t3);
		insert(t4);
		
		Tema_estudiante tema_estud1 = new Tema_estudiante(t1.getId_tema(), e1.getId(), 0.0);
		Tema_estudiante tema_estud2 = new Tema_estudiante(t2.getId_tema(), e1.getId(), 0.0);
		Tema_estudiante tema_estud3 = new Tema_estudiante(t3.getId_tema(), e1.getId(), 0.0);
		Tema_estudiante tema_estud4 = new Tema_estudiante(t4.getId_tema(), e1.getId(), 0.0);
		insert(tema_estud1);
		insert(tema_estud2);
		insert(tema_estud3);
		insert(tema_estud4);
		//---
		Tarea tar1 = new Tarea(t1.getId_tema(), "Ejercicio 1", 8);
		Tarea tar2 = new Tarea(t1.getId_tema(), "Tarea 1", 7);
		Tarea tar3 = new Tarea(t1.getId_tema(), "Assignment 2", 6);
		insert(tar1);
		insert(tar2);
		insert(tar3);
		
		Tarea_estudiante tar_estud1 = new Tarea_estudiante(tar1.getId_tarea(), t1.getId_tema(), e1.getId(), 26.0);
		Tarea_estudiante tar_estud2 = new Tarea_estudiante(tar2.getId_tarea(), t1.getId_tema(), e1.getId(), 76.0);
		Tarea_estudiante tar_estud3 = new Tarea_estudiante(tar3.getId_tarea(), t1.getId_tema(), e1.getId(), 96.0);
		insert(tar_estud1);
		insert(tar_estud2);
		insert(tar_estud3);
		//---
		Tarea tar4 = new Tarea(t2.getId_tema(), "Proyecto 1", 8);
		Tarea tar5 = new Tarea(t2.getId_tema(), "Ejercicio 5", 8);
		Tarea tar6 = new Tarea(t2.getId_tema(), "Tarea 3", 8);
		insert(tar4);
		insert(tar5);
		insert(tar6);
		
		Tarea_estudiante tar_estud4 = new Tarea_estudiante(tar4.getId_tarea(), t2.getId_tema(), e1.getId(), 76.0);
		Tarea_estudiante tar_estud5 = new Tarea_estudiante(tar5.getId_tarea(), t2.getId_tema(), e1.getId(), 56.0);
		Tarea_estudiante tar_estud6 = new Tarea_estudiante(tar6.getId_tarea(), t2.getId_tema(), e1.getId(), 36.0);
		insert(tar_estud4);
		insert(tar_estud5);
		insert(tar_estud6);
		//---
		Tarea tar7 = new Tarea(t3.getId_tema(), "Ejercicio 5", 8);
		Tarea tar8 = new Tarea(t3.getId_tema(), "Tarea 9", 7);
		Tarea tar9 = new Tarea(t3.getId_tema(), "Examen 2", 6);
		insert(tar7);
		insert(tar8);
		insert(tar9);
		
		Tarea_estudiante tar_estud7 = new Tarea_estudiante(tar7.getId_tarea(), t3.getId_tema(), e1.getId(), 86.0);
		Tarea_estudiante tar_estud8 = new Tarea_estudiante(tar8.getId_tarea(), t3.getId_tema(), e1.getId(), 46.0);
		Tarea_estudiante tar_estud9 = new Tarea_estudiante(tar9.getId_tarea(), t3.getId_tema(), e1.getId(), 56.0);
		insert(tar_estud7);
		insert(tar_estud8);
		insert(tar_estud9);
		//---
		Tarea tar10 = new Tarea(t4.getId_tema(), "Prueba 1", 8);
		Tarea tar11 = new Tarea(t4.getId_tema(), "Examen 3", 7);
		Tarea tar12 = new Tarea(t4.getId_tema(), "Ejercicios 2", 6);
		insert(tar10);
		insert(tar11);
		insert(tar12);
		
		Tarea_estudiante tar_estud10 = new Tarea_estudiante(tar10.getId_tarea(), t4.getId_tema(), e1.getId(), 36.0);
		Tarea_estudiante tar_estud11 = new Tarea_estudiante(tar11.getId_tarea(), t4.getId_tema(), e1.getId(), 26.0);
		Tarea_estudiante tar_estud12 = new Tarea_estudiante(tar12.getId_tarea(), t4.getId_tema(), e1.getId(), 46.0);
		insert(tar_estud10);
		insert(tar_estud11);
		insert(tar_estud12);
		//---
end

/*rule "Insertar datos"
	when
	then
		Tarea t1 = new Tarea("ejercicio 1", 55.0, 9);
		Tarea t2 = new Tarea("ejercicio 2", 65.0, 8);
		Tarea t3 = new Tarea("ejercicio 3", 50.0, 6);
		Tarea t11 = new Tarea("tarea 1", 66.0, 9);
		Tarea t22 = new Tarea("tarea 2", 54.0, 7);
		Tarea t33 = new Tarea("tarea 3", 58.0, 6);
		List<Tarea> ejercicios = new ArrayList<Tarea>();
		ejercicios.add(t1);
		ejercicios.add(t2);
		ejercicios.add(t3);
		List<Tarea> ejercicios2 = new ArrayList<Tarea>();
		ejercicios2.add(t11);
		ejercicios2.add(t22);
		ejercicios2.add(t33);
		Tema te1 = new Tema("MRUA", 7, ejercicios, 0.0);
		Tema te2 = new Tema("Caida Libre", 5, ejercicios2, 0.0);
		List<Tema> temas1 = new ArrayList<Tema>();
		temas1.add(te1);
		temas1.add(te2);
		Materia m1 = new Materia("Fisica", "Juan marcos castenad", 0.0, 25.0, 7, temas1);
		insert(m1);
		
		Tarea ta1 = new Tarea("ejercicio 1", 100.0, 9);
		Tarea ta2 = new Tarea("ejercicio 2", 100.0, 8);
		Tarea ta3 = new Tarea("ejercicio 3", 100.0, 6);
		Tarea ta11 = new Tarea("tarea 1", 100.0, 9);
		Tarea ta22 = new Tarea("tarea 2", 100.0, 7);
		Tarea ta33 = new Tarea("tarea 3", 100.0, 6);
		List<Tarea> ejercicios3 = new ArrayList<Tarea>();
		ejercicios3.add(ta1);
		ejercicios3.add(ta2);
		ejercicios3.add(ta3);
		List<Tarea> ejercicios4 = new ArrayList<Tarea>();
		ejercicios4.add(ta11);
		ejercicios4.add(ta22);
		ejercicios4.add(ta33);
		Tema te11 = new Tema("Divisiones", 7, ejercicios3, 0.0);
		Tema te22 = new Tema("Limites", 5, ejercicios4, 0.0);
		List<Tema> temas2 = new ArrayList<Tema>();
		temas2.add(te11);
		temas2.add(te22);
		Materia m2 = new Materia("Matematicas", "Pedro lopez de silao", 0.0, 35.0, 7, temas2);
		insert(m2);
		
		List<Materia> materias = new ArrayList<Materia>();
		materias.add(m1);
		materias.add(m2);
		List<String> recoms = new ArrayList<String>();
		insert( new Estudiante("San Luis Potosi", 0.0, materias, recoms) );
		
		//------------------------------------------------
		
		Tarea tar1 = new Tarea("ejercicio 1", 55.0, 8);
		Tarea tar2 = new Tarea("ejercicio 2", 45.0, 9);
		Tarea tar3 = new Tarea("ejercicio 3", 50.0, 6);
		Tarea tar11 = new Tarea("tarea 1", 66.0, 9);
		Tarea tar22 = new Tarea("tarea 2", 54.0, 7);
		Tarea tar33 = new Tarea("tarea 3", 58.0, 6);
		List<Tarea> ejerciciosA = new ArrayList<Tarea>();
		ejerciciosA.add(tar1);
		ejerciciosA.add(tar2);
		ejerciciosA.add(tar3);
		List<Tarea> ejercicios2A = new ArrayList<Tarea>();
		ejercicios2A.add(tar11);
		ejercicios2A.add(tar22);
		ejercicios2A.add(tar33);
		Tema tem1 = new Tema("MRUA", 7, ejerciciosA, 0.0);
		Tema tem2 = new Tema("Caida Libre", 5, ejercicios2A, 0.0);
		List<Tema> temas1A = new ArrayList<Tema>();
		temas1A.add(tem1);
		temas1A.add(tem2);
		Materia m1B = new Materia("Fisica", "Juan marcos castenad", 0.0, 25.0, 7, temas1A);
		insert(m1B);
		
		Tarea tare1 = new Tarea("ejercicio 1", 45.0, 9);
		Tarea tare2 = new Tarea("ejercicio 2", 55.0, 8);
		Tarea tare3 = new Tarea("ejercicio 3", 50.0, 6);
		Tarea tare11 = new Tarea("tarea 1", 56.0, 9);
		Tarea tare22 = new Tarea("tarea 2", 34.0, 7);
		Tarea tare33 = new Tarea("tarea 3", 38.0, 6);
		List<Tarea> ejercicios3A = new ArrayList<Tarea>();
		ejercicios3A.add(tare1);
		ejercicios3A.add(tare2);
		ejercicios3A.add(tare3);
		List<Tarea> ejercicios4A = new ArrayList<Tarea>();
		ejercicios4A.add(tare11);
		ejercicios4A.add(tare22);
		ejercicios4A.add(tare33);
		Tema te11A = new Tema("Divisiones", 7, ejercicios3A, 0.0);
		Tema te22A = new Tema("Limites", 5, ejercicios4A, 0.0);
		List<Tema> temas2A = new ArrayList<Tema>();
		temas2A.add(te11A);
		temas2A.add(te22A);
		Materia m2B = new Materia("Matematicas", "Pedro lopez de silao", 0.0, 35.0, 7, temas2A);
		insert(m2B);
		
		List<Materia> materias2 = new ArrayList<Materia>();
		materias2.add(m1B);
		materias2.add(m2B);
		List<String> recoms2 = new ArrayList<String>();
		insert( new Estudiante("Gabriel Garcia Marquez", 0.0, materias2, recoms2) );
		
		//-----------------------------------------------
		
		insert(new Materia("Mates",7));
end

rule "Calcular promedio global -> en cadena se obtiene el promedio de tareas por tema por materia por cada una en la lista de materias"
    //include attributes such as "salience" here...
    salience 100
    when
        $e : Estudiante($materias : materiasCursando );
        eval($materias != null);
    then
    	$e.setPromedioGlobal($e.getPromedioTotal($materias));
        System.out.println("Estudiante encontrado!!: " + $e.toString());
end

rule "Encontrar temas"
	when
		$e : Estudiante( $materias : materiasCursando );
		$mat : Materia() from $materias;
		$temas : Tema() from $mat.getTemas();
		$t : Tema(nombre == "MRUA") from $temas;
	then
		System.out.println("Se encontro: " + $t.getNombre());
end

rule "Mal historial, reprobando materia media-alta, pero con tiempo"
	when
		$e : Estudiante( $materias : materiasCursando );
		$mat : Materia() from $materias;
		eval($mat.getPromedioAlumno() < 60 
		&& ($mat.getNivelCurso() > 5 && $mat.getNivelCurso() < 8) 
		&& $mat.getPorcentajeCompl() < 50 
		&& $e.getPromedioGlobal() < 65 );
	then
		//System.out.println($e.getNombre() + ", tu historial es malo, tu promedio en la materia: "
		//+ $mat.getNombre() + " es reprobatorio y el nivel de la clase es medio-alto; pero todavÃ­a tienes tiempo, busca asesoria");
		$e.getRecomendaciones().add($e.getNombre() + ", tu promedio global es bueno, tu promedio en la materia: " 
		+ $mat.getNombre() + " es reprobatorio y el nivel de la clase es medio-alto; pero todavÃ­a tienes tiempo, practica y ponte al corriente");
end

rule "Mal historial, reprobando materia media-alta, pero sin tiempo"
	when
		$e : Estudiante( $materias : materiasCursando );
		$mat : Materia() from $materias;
		eval($mat.getPromedioAlumno() < 60 
		&& ($mat.getNivelCurso() > 5 && $mat.getNivelCurso() < 8) 
		&& $mat.getPorcentajeCompl() > 75 
		&& $e.getPromedioGlobal() < 65 );
	then
		$e.getRecomendaciones().add($e.getNombre() + ", tu promedio global es malo, tu promedio en la materia: " 
		+ $mat.getNombre() + " es reprobatorio y el nivel de la clase es medio-alto y ya estÃ¡ por concluir el curso. "
		+ "Te recomendamos tomar asesorÃ­as con el profesor " + $mat.getMaestro() + "lo mÃ¡s pronto posible");
end

rule "Mal historial, aprobando materia media-alta, con tiempo"
	when
		$e : Estudiante( $materias : materiasCursando );
		$mat : Materia() from $materias;
		eval($mat.getPromedioAlumno() >= 70 
		&& ($mat.getNivelCurso() > 5 && $mat.getNivelCurso() < 8) 
		&& $mat.getPorcentajeCompl() < 50 
		&& $e.getPromedioGlobal() < 65 );
	then
		$e.getRecomendaciones().add($e.getNombre() + ", tu promedio global ha sido malo, pero tu promedio en la materia: " 
		+ $mat.getNombre() + " va mejorando. Â¡Felicidades! Sigue asÃ­ lo que resta del curso.");
end

rule "Mal historial, aprobando materia media-alta, sin tiempo"
	when
		$e : Estudiante( $materias : materiasCursando );
		$mat : Materia() from $materias;
		eval($mat.getPromedioAlumno() >= 70 
		&& ($mat.getNivelCurso() > 5 && $mat.getNivelCurso() < 8) 
		&& $mat.getPorcentajeCompl() > 75 
		&& $e.getPromedioGlobal() < 65 );
	then
		$e.getRecomendaciones().add($e.getNombre() + ", tu promedio global ha sido malo, pero tu promedio en la materia: " 
		+ $mat.getNombre() + " va mejorando. Â¡Felicidades! Sigue asÃ­ y tu promedio global subirÃ¡, ya casi acabas.");
end

rule "Buen historial, reprobando materia media-alta, pero con tiempo"

	when
		$e : Estudiante( $materias : materiasCursando, $recomendaciones : recomendaciones );
		$mat : Materia() from $materias;
		eval($mat.getPromedioAlumno() < 60 
		&& ($mat.getNivelCurso() > 5 && $mat.getNivelCurso() < 8) 
		&& $mat.getPorcentajeCompl() < 50 
		&& $e.getPromedioGlobal() > 75 );
	then
		//System.out.println($e.getNombre() + ", tu historial es bueno, tu promedio en la materia: " 
		//+ $mat.getNombre() + " es reprobatorio y el nivel de la clase es medio-alto; pero todavÃ­a tienes tiempo, practica y ponte al corriente");
		$e.getRecomendaciones().add($e.getNombre() + ", tu promedio global es bueno, tu promedio en la materia: " 
		+ $mat.getNombre() + " es reprobatorio y el nivel de la clase es medio-alto; pero todavÃ­a tienes tiempo, practica y ponte al corriente");
end

rule "Buen historial, reprobando materia media-alta, pero sin tiempo"
	when
		$e : Estudiante( $materias : materiasCursando );
		$mat : Materia() from $materias;
		eval($mat.getPromedioAlumno() < 60 
		&& ($mat.getNivelCurso() > 5 && $mat.getNivelCurso() < 8) 
		&& $mat.getPorcentajeCompl() > 75 
		&& $e.getPromedioGlobal() > 75 );
	then
		$e.getRecomendaciones().add($e.getNombre() + ", tu promedio global es malo, tu promedio en la materia: " 
		+ $mat.getNombre() + " es reprobatorio y el nivel de la clase es medio-alto y ya estÃ¡ por concluir el curso. "
		+ "Te recomendamos tomar asesorÃ­as con el profesor " + $mat.getMaestro() + "para mejorar tus resultados");
end

rule "Buen historial, aprobando materia media-alta"
	when
		$e : Estudiante( $materias : materiasCursando );
		$mat : Materia() from $materias;
		eval($mat.getPromedioAlumno() >= 70 
		&& ($mat.getNivelCurso() > 5 && $mat.getNivelCurso() < 8)  
		&& $e.getPromedioGlobal() > 75 );
	then
		$e.getRecomendaciones().add($e.getNombre() + ", tu promedio global y tu promedio en la materia: " 
		+ $mat.getNombre() + " son muy buenos. Sigue asÃ­ para mantener un excelente promedio");
end

rule "Inscripcion futura nivel alto"

	when
		$e1 : EstudInscripcion( $e1.getMateriaAInscribir().getNivelCurso() > 7 
		&& promedioGlobal > 75 );
	then
		//System.out.println($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es muy alta para tu nivel");
		$e1.getRecomendaciones().add($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es muy alta para tu nivel");
end


rule "Inscripcion futura nivel correcto(medio)"

	when
		$e1 : EstudInscripcion( ($e1.getMateriaAInscribir().getNivelCurso() >= 3
		&& $e1.getMateriaAInscribir().getNivelCurso() <= 7)
		&& promedioGlobal > 75 );
	then
		//System.out.println($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es perfecta para tu nivel");
		$e1.getRecomendaciones().add($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es perfecta para tu nivel");
end

rule "Inscripcion futura nivel correcto"

	when
		$e1 : EstudInscripcion( $e1.getMateriaAInscribir().getNivelCurso() > 7 
		&& promedioGlobal > 75 );
	then
		//System.out.println($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es perfecta para tu nivel");
		$e1.getRecomendaciones().add($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es perfecta para tu nivel");
end

rule "Inscripcion futura nivel bajo"
	when
		$e1 : EstudInscripcion( materiaAInscribir.getNivelCurso() < 3
		&& promedioGlobal > 75 );
	then
		//System.out.println($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es muy baja para tu nivel");
		$e1.getRecomendaciones().add($e1.getNombre() + ", la materia: " + $e1.getMateriaAInscribir().getNombre() + ", es muy baja para tu nivel");
end
*/
